<?xml version="1.0" encoding="UTF-8"?>
<!DOCTYPE mapper PUBLIC "-//mybatis.org//DTD mapper 3.0//EN" "http://mybatis.org/dtd/mybatis-3-mapper.dtd" >
<mapper namespace="schedule">

	<insert id="insertSchedule" parameterType="schedule">
		insert into schedule values(seq_schedule.nextval,#{travelTheme},#{partyName},#{userId},#{title},#{startDate},#{endDate},#{peopleNum},#{publicFlag},default,default,default,default,default,sysdate,#{placeNo})
		<selectKey keyProperty="scheduleNo" resultType="_int" order="AFTER">
			select seq_schedule.currval from dual
		</selectKey>
	</insert>
  	<insert id="insertTimeTable" parameterType="timetable">
  		insert into timetable values(#{scheduleNo}, #{placeNo}, #{day}, #{time})
  	</insert>
  	
  	<select id="selectScheduleList" resultType="map">
		SELECT * FROM(SELECT S.*,P.THUMBNAIL FROM SCHEDULE S INNER JOIN PLACE P ON(S.PLACENO=P.PLACENO) ORDER BY ROWNUM DESC)
  	</select>
  	
  	<select id="selectTotalCount" resultType="_int">
		select count(*) from schedule
	</select>
	
	<select id="selectSchedule" parameterType="_int" resultType="map">
		select S.*,R.nickname as nickname,to_char(startdate,'yyyy-mm-dd') as startdate1, to_char(enddate,'yyyy-mm-dd') as enddate1 from schedule S join rp_user R on(R.userid=S.userid)where scheduleno=#{scheduleNo}
	</select>
	<select id="selectTimeTableList" parameterType="_int" resultType="map">
		select tt.*,p.title , p.address, p.majorcategory from timetable tt join place p on(tt.placeno=p.placeno)where scheduleno=#{scheduleNo}
	</select>
	
	<update id="updateSchedule" parameterType="schedule" >
		update schedule set traveltheme=#{travelTheme}, partyname=#{partyName}, title=#{title}, startdate=#{startDate}, enddate=#{endDate}, peoplenum=#{peopleNum}, publicflag=#{publicFlag},writedate=sysdate, placeno=#{placeNo} where scheduleno=#{scheduleNo}
	</update>
	<delete id="deleteTimeTable" parameterType="_int" >
		delete from timetable where scheduleno=#{scheduleNo}
	</delete>
	<!-- <delete id="scheduleDelete" parameterMap="_int">
		delete from schedule where scheduleno=#{scheduleNo}
	</delete> -->
</mapper>
